# QA

В модела е най-лесно, но някои неща се налага да ги направим в контролера или евентуално в мидълеъра или сървиса (ако е интелигентен, а нашите са глупави)(парола).

Нашата ситуация (в двата края): Контролера, в края и базата!

1. Модел User
2. Плейсхолдер Play за да не гърми
3. Сървиса можем да не пипаме, евентуално likedPlays: []
4. Мидълеърите, няма кво.
5. Евентуално можем да добавим в токена харесаните пиеси, но ... не, ще ги дърпаме от базата всеки път.
6. authController, bail за да не продължи към следващата проверка.
7. В случай на грешка я логваме в конзолата и я слагаме в обект errors.

Boolean(public), undefined->false, on->true

Добре е валидациите да са на едно и също място, защото ще парсваме само един вид грешки. Ако са на 3 места (express-validator, model и твои си в контролера трябва да се парсват по 3 различни начина).

Вместо express-validator-а може с if-чета, но ако не са много завъртяни.

Гардовете проверяват дали има закачен потребител в сесията.
Ако сесията изтече, преди да е натиснал бутона ще го редиректне към логин страницата, което ще е доста неприятно, защото ще се загубят данните, но
... такъв е живота!

General Middleware -> кукипарсър, бодипарсър

Services – сървисите, които ръчно сме закачили -> сторич, аут

В express има доста неща -> ...

Мидълеърите пипат рекуест дейтата ... бодито е стрийм ... взима стрийма, парсва го, превръща го в обикновен обект ...
Кукипарсъра – също взима кукито и го превръща в обект
Аут -> проверява токена и ще популира рекуест дейтата с някакъв потребител

След общите мидълеъри минаваме към рутера, който ще го пренасочи към конкретен контролер и неговия екшън ...
За всеки контролер може да имаме специален мидълеър (раут), който се изпълнява само за съответния раут и също можем да закачим сървис!
Пример за раут мидълеър са гардовете (проверяват какво има в рекуест дейтата и дали има закачен юзър и ако няма прекратяват пътя на заявката (рекуеста) и връщат респонс с ... да се логнеш)

Накрая стигаме до обработката на заявката ... стигаме до един контролер и неговите екшъни (контролера е рутера, който създаваме, а екшъните са всяко едно действие)

Екшъна може да бръкне в мидълеъра и по този начин да достигне до сървиса, функционалността, която exoress е закачил или да бръкне в данните ...
Накрая идва респонса, който стига обратно до клиента!

2 функции:

1. Код, който обработва заявките.
2. Код, който стартира конфигуриращия код (всичко в config) -> стартира базата, инициализира мидълеърите и ги закача, закача и рутерите

Кода, който върши работата са сървисите, мидълеърите, които зареждат сървисите и контролерите, които обработват заявките с помоща на това, което мидълеъра е закачил.

Моделите са правилата, чрез които mongoose (Object Data Modeling (ODM) library for MongoDB and Node) ще валидира данните.

Вюта за вю-енджина ...

От контролера към модела е по-лесно да се пише, защото изрендваме статичния шаблон, логваме данните и почваме да правиме функциите към мидълеъра, към модела (в дълбочина)

Не забравяйте тримовете при рег. лог. едитване, създаване ...
В контролера, но защо не горе (Виктор: като го видя и ми става лошо – много скоби, много нещо)

Трим има и в монгус като рекуайър ???
